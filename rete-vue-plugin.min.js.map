{"version":3,"file":"rete-vue-plugin.min.js","sources":["../src/renderer.ts","../src/vuecompat/vue3.ts","../src/presets/classic/components/Connection.vue","../src/presets/classic/components/ConnectionWrapper.vue","../src/presets/classic/components/Control.vue","../src/Ref.vue","../src/presets/classic/components/Node.vue","../src/presets/classic/components/Socket.vue","../src/presets/classic/index.ts","../src/presets/context-menu/components/Search.vue","../src/presets/context-menu/utils/debounce.ts","../src/presets/context-menu/components/Item.vue","../src/presets/context-menu/components/Menu.vue","../src/presets/context-menu/index.ts","../src/presets/minimap/utils.ts","../src/presets/minimap/MiniNode.vue","../src/shared/drag.ts","../src/presets/minimap/MiniViewport.vue","../src/presets/minimap/Minimap.vue","../src/presets/minimap/index.ts","../src/presets/reroute/Pins.vue","../src/presets/reroute/Pin.vue","../src/presets/reroute/index.ts","../src/index.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { create, destroy, update } from 'process.env.VUECOMPAT'\n\nexport type Renderer<I> = {\n  get(element: Element): I | undefined\n  mount<P>(element: Element, vueComponent: any, payload: P, onRendered: any): I\n  update<P>(app: I, payload: P): void\n  unmount(element: Element): void\n}\n\nexport function getRenderer<I>(): Renderer<I> {\n  const instances = new Map<Element, I>()\n\n  return {\n    get(element) {\n      return instances.get(element)\n    },\n    mount(element, vueComponent, payload, onRendered) {\n      const app = create(element, vueComponent, payload, onRendered)\n\n      instances.set(element, app)\n\n      return app\n    },\n    update(app, payload) {\n      update(app, payload)\n    },\n    unmount(element) {\n      const app = instances.get(element)\n\n      if (app) {\n        destroy(app)\n        instances.delete(element)\n      }\n    }\n  }\n}\n","/* eslint-disable @typescript-eslint/ban-ts-comment */\n// @ts-ignore\nimport { App, createApp, h, markRaw, Ref, ref } from 'vue'\n\ntype Instance<P> = { app: App<Element>, payload: Ref<P> }\n\nexport function create<P extends object>(element: HTMLElement, component: any, payload: P, onRendered: any): Instance<P> {\n  const state = ref(markRaw(payload)) as Ref<P>\n\n  const app = createApp({\n    render() {\n      // @ts-ignore\n      return h(component, { ...state.value, seed: Math.random() })\n    },\n    mounted() {\n      onRendered()\n    },\n    updated() {\n      onRendered()\n    }\n  })\n\n  app.mount(element)\n\n  return {\n    app,\n    payload: state\n  }\n}\n\nexport function update<P extends object>(instance: Instance<P>, payload: P) {\n  instance.payload.value = markRaw({ ...instance.payload.value, ...payload })\n}\n\nexport function destroy(instance: Instance<unknown>) {\n  instance.app.unmount()\n}\n","<template lang=\"pug\">\nsvg(data-testid=\"connection\")\n  path(:d=\"path\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data', 'start', 'end', 'path']\n})\n</script>\n\n<style lang=\"scss\" scoped>\n/*! https://github.com/retejs/connection-plugin/commit/206ca0fd7fb82801ac45a0f7180ae05dff9ed901 */\nsvg {\n  overflow: visible !important;\n  position: absolute;\n  pointer-events: none;\n  width: 9999px;\n  height: 9999px;\n  path {\n    fill: none;\n    stroke-width: 5px;\n    stroke: steelblue;\n    pointer-events: auto;\n  }\n}\n</style>\n","<template lang=\"pug\">\ncomponent(:is=\"component\" :data=\"data\" :start=\"startPosition\" :end=\"endPosition\", :path=\"observedPath\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  props: ['component', 'data', 'start', 'end', 'path'],\n  data() {\n    return {\n      observedStart: { x: 0, y: 0 },\n      observedEnd: { x: 0, y: 0 },\n      observedPath: '',\n      onDestroy: null\n    }\n  },\n  computed: {\n    startPosition() {\n      if (this.start && 'x' in this.start) return this.start\n      return this.observedStart\n    },\n    endPosition() {\n      if (this.end && 'x' in this.end) return this.end\n      return this.observedEnd\n    }\n  },\n  watch: {\n    startPosition() { this.fetchPath() },\n    endPosition() { this.fetchPath() }\n  },\n  methods: {\n    async fetchPath() {\n      if (this.startPosition && this.endPosition) {\n        this.observedPath = await this.path(this.startPosition, this.endPosition)\n      }\n    }\n  },\n  created() {\n    const unwatch1 = typeof this.start === 'function' && this.start(pos => {\n      this.observedStart = pos\n    })\n    const unwatch2 = typeof this.end === 'function' && this.end(pos => {\n      this.observedEnd = pos\n    })\n\n    this.onDestroy = () => {\n      unwatch1 && unwatch1()\n      unwatch2 && unwatch2()\n    }\n  },\n  destroyed() {\n    if (this.onDestroy) this.onDestroy()\n  }\n})\n</script>\n","<template lang=\"pug\">\ninput(\n  :type=\"data.type\"\n  :value=\"data.value\"\n  :readonly=\"data.readonly\"\n  @input=\"change\"\n  @pointerdown.stop=\"\"\n)\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data'],\n  methods: {\n    change(e) {\n      const val = this.data.type === 'number'\n        ? +e.target.value\n        : e.target.value\n\n      this.data.setValue(val)\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\ninput {\n  width: 100%;\n  border-radius: 30px;\n  background-color: white;\n  padding: 2px 6px;\n  border: 1px solid #999;\n  font-size: 110%;\n  box-sizing: border-box;\n}\n</style>\n","<template lang=\"pug\">\ndiv(v-bind=\"$props\" ref=\"element\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data', 'emit'],\n  mounted() {\n    this.emit({ type: 'render', data: { ...this.data, element: this.$refs.element } })\n  },\n  beforeDestroy() {\n    this.emit({ type: 'unmount', data: { element: this.$refs.element } })\n  },\n  beforeUnmount() {\n    this.emit({ type: 'unmount', data: { element: this.$refs.element } })\n  }\n})\n</script>\n","<template lang=\"pug\">\n.node(:class=\"{ selected: data.selected }\" :style=\"nodeStyles()\" data-testid=\"node\")\n  .title(data-testid=\"title\") {{data.label}}\n\n  // Outputs\n  .output(v-for='[key, output] in outputs()' :key=\"'output' + key + seed\" :data-testid=\"'output-'+key\")\n    .output-title(data-testid=\"output-title\") {{output.label}}\n    Ref.output-socket(\n      :data=\"{ type: 'socket', side: 'output', key: key, nodeId: data.id, payload: output.socket }\"\n      :emit=\"emit\"\n      data-testid=\"output-socket\")\n\n  // Controls\n  Ref.control(\n    v-for='[key, control] in controls()',\n    :key=\"'control' + key + seed\",\n    :data-testid=\"'control-'+key\"\n    :emit=\"emit\"\n    :data=\"{ type: 'control', payload: control }\"\n  )\n\n  // Inputs\n  .input(v-for='[key, input] in inputs()' :key=\"'input' + key + seed\" :data-testid=\"'input-'+key\")\n    Ref.input-socket(\n      :data=\"{ type: 'socket', side: 'input', key: key, nodeId: data.id, payload: input.socket }\"\n      :emit=\"emit\"\n      data-testid=\"input-socket\"\n    )\n    .input-title(v-show='!input.control || !input.showControl' data-testid=\"input-title\") {{input.label}}\n    Ref.input-control(\n      v-show='input.control && input.showControl'\n      :emit=\"emit\"\n      :data=\"{ type: 'control', payload: input.control }\"\n      data-testid=\"input-control\"\n    )\n</template>\n\n\n<script lang=\"js\">\nimport { defineComponent } from 'vue'\nimport Ref from '../../../Ref.vue'\n\nfunction sortByIndex(entries) {\n  entries.sort((a, b) => {\n    const ai = a[1] && a[1].index || 0\n    const bi = b[1] && b[1].index || 0\n\n    return ai - bi\n  })\n  return entries\n}\n\nexport default defineComponent({\n  props: ['data', 'emit', 'seed'],\n  methods: {\n    nodeStyles() {\n      return {\n        width: Number.isFinite(this.data.width) ? `${this.data.width}px` : '',\n        height: Number.isFinite(this.data.height) ? `${this.data.height}px` : ''\n      }\n    },\n    inputs() {\n      return sortByIndex(Object.entries(this.data.inputs))\n    },\n    controls() {\n      return sortByIndex(Object.entries(this.data.controls))\n    },\n    outputs() {\n      return sortByIndex(Object.entries(this.data.outputs))\n    }\n  },\n  components: {\n    Ref\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\n.node {\n  background: $node-color;\n  border: 2px solid #4e58bf;\n  border-radius: 10px;\n  cursor: pointer;\n  box-sizing: border-box;\n  width: $node-width;\n  height: auto;\n  padding-bottom: 6px;\n  position: relative;\n  user-select: none;\n  line-height: initial;\n  font-family: Arial;\n\n  &:hover {\n    background: lighten($node-color, 4%);\n  }\n\n  &.selected {\n    background: $node-color-selected;\n    border-color: #e3c000;\n  }\n\n  .title {\n    color: white;\n    font-family: sans-serif;\n    font-size: 18px;\n    padding: 8px;\n  }\n\n  .output {\n    text-align: right;\n  }\n\n  .input {\n    text-align: left;\n  }\n\n  .output-socket {\n    text-align: right;\n    margin-right: -(math.div($socket-size, 2) + $socket-margin);\n    display: inline-block;\n  }\n\n  .input-socket {\n    text-align: left;\n    margin-left: -(math.div($socket-size, 2) + $socket-margin);\n    display: inline-block;\n  }\n\n  .input-title,\n  .output-title {\n    vertical-align: middle;\n    color: white;\n    display: inline-block;\n    font-family: sans-serif;\n    font-size: 14px;\n    margin: $socket-margin;\n    line-height: $socket-size;\n  }\n\n  .input-control {\n    z-index: 1;\n    width: calc(100% - #{$socket-size + 2*$socket-margin});\n    vertical-align: middle;\n    display: inline-block;\n  }\n\n  .control {\n    padding: $socket-margin math.div($socket-size, 2) + $socket-margin;\n  }\n}\n</style>\n","<template lang=\"pug\">\n.socket(\n  :title=\"data.name\"\n)\n</template>\n\n<script>\nexport default {\n  props: ['data']\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\n.socket {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid white;\n  border-radius: math.div($socket-size, 2);\n  width: $socket-size;\n  height: $socket-size;\n  margin: $socket-margin;\n  vertical-align: middle;\n  background: $socket-color;\n  z-index: 2;\n  box-sizing: border-box;\n  &:hover {\n    border-width: 4px;\n  }\n  &.multiple {\n    border-color: yellow;\n  }\n  &.output {\n    margin-right: - math.div($socket-size, 2);\n  }\n  &.input {\n    margin-left: - math.div($socket-size, 2);\n  }\n}\n</style>\n","import { ClassicPreset, Scope } from 'rete'\nimport { classicConnectionPath, getDOMSocketPosition, loopConnectionPath, SocketPositionWatcher } from 'rete-render-utils'\nimport Vue, { DefineComponent, VueConstructor } from 'vue'\n\nimport { Position } from '../../types'\nimport { RenderPreset } from '../types'\nimport Connection from './components/Connection.vue'\nimport ConnectionWrapper from './components/ConnectionWrapper.vue'\nimport Control from './components/Control.vue'\nimport Node from './components/Node.vue'\nimport Socket from './components/Socket.vue'\nimport { ClassicScheme, ExtractPayload, VueArea2D } from './types'\n\nexport { default as Connection } from './components/Connection.vue'\nexport { default as Control } from './components/Control.vue'\nexport { default as Node } from './components/Node.vue'\nexport { default as Socket } from './components/Socket.vue'\n\ntype Component<Props extends Record<string, any>> =\n  | VueConstructor<Vue<Record<string, any>, Props>>\n  | DefineComponent<Props, any, any, any, any, any, any, any, any, any, any>\n\ntype CustomizationProps<Schemes extends ClassicScheme> = {\n  node?: (data: ExtractPayload<Schemes, 'node'>) => Component<any> | null\n  connection?: (data: ExtractPayload<Schemes, 'connection'>) => Component<any> | null\n  socket?: (data: ExtractPayload<Schemes, 'socket'>) => Component<any> | null\n  control?: (data: ExtractPayload<Schemes, 'control'>) => Component<any> | null\n}\ntype ClassicProps<Schemes extends ClassicScheme, K> = {\n  socketPositionWatcher?: SocketPositionWatcher<Scope<never, [K]>>,\n  customize?: CustomizationProps<Schemes>\n}\n\n/**\n * Classic preset for rendering nodes, connections, controls and sockets.\n */\nexport function setup<Schemes extends ClassicScheme, K extends VueArea2D<Schemes>>(\n  props?: ClassicProps<Schemes, K>\n): RenderPreset<Schemes, K> {\n  const positionWatcher = typeof props?.socketPositionWatcher === 'undefined'\n    ? getDOMSocketPosition<Schemes, K>()\n    : props?.socketPositionWatcher\n  const { node, connection, socket, control } = props?.customize || {}\n\n  return {\n    attach(plugin) {\n      positionWatcher.attach(plugin as unknown as Scope<never, [K]>)\n    },\n    update(context, plugin) {\n      const { payload } = context.data\n      const parent = plugin.parentScope()\n\n      if (!parent) throw new Error('parent')\n      const emit = parent.emit.bind(parent)\n\n      if (context.data.type === 'node') {\n        return { data: payload, emit }\n      } else if (context.data.type === 'connection') {\n        const { start, end } = context.data\n\n        return {\n          data: payload,\n          ...(start ? { start } : {}),\n          ...(end ? { end } : {})\n        }\n      }\n      return { data: payload }\n    },\n    // eslint-disable-next-line max-statements, complexity\n    render(context, plugin) {\n      const parent = plugin.parentScope()\n      const emit = parent.emit.bind(parent)\n\n      if (context.data.type === 'node') {\n        const component = node ? node(context.data) : Node\n\n        return component && {\n          component, props: {\n            data: context.data.payload,\n            emit\n          }\n        }\n      } else if (context.data.type === 'connection') {\n        const component = connection ? connection(context.data) : Connection\n        const { payload } = context.data\n        const { source, target, sourceOutput, targetInput } = payload\n\n        return component && {\n          component: ConnectionWrapper, props: {\n            data: context.data.payload,\n            component,\n            start: context.data.start || ((change: any) => positionWatcher.listen(source, 'output', sourceOutput, change)),\n            end: context.data.end || ((change: any) => positionWatcher.listen(target, 'input', targetInput, change)),\n            path: async (start: Position, end: Position) => {\n              const response = await plugin.emit({ type: 'connectionpath', data: { payload, points: [start, end] } })\n\n              if (!response) return ''\n\n              const { path, points } = response.data\n              const curvature = 0.3\n\n              if (!path && points.length !== 2) throw new Error('cannot render connection with a custom number of points')\n              if (!path) return payload.isLoop\n                ? loopConnectionPath(points as [Position, Position], curvature, 120)\n                : classicConnectionPath(points as [Position, Position], curvature)\n\n              return path\n            }\n          }\n        }\n      } else if (context.data.type === 'socket') {\n        const { payload } = context.data\n        const component = socket ? socket(context.data) : Socket\n\n        return {\n          component, props: {\n            data: payload\n          }\n        }\n      } else if (context.data.type === 'control') {\n        const { payload } = context.data\n\n        if (control) {\n          const component = control(context.data)\n\n          return component && {\n            component, props: {\n              data: payload\n            }\n          }\n        }\n\n        return context.data.payload instanceof ClassicPreset.InputControl\n          ? {\n            component: Control, props: {\n              data: payload\n            }\n          }\n          : null\n      }\n    }\n  }\n}\n","<template lang=\"pug\">\n//- v-model cannot be used here due to compatibility with Vue 2 and 3\ninput.search(\n  :value=\"text\"\n  @input=\"$emit('change', $event.target.value)\"\n  data-testid=\"context-menu-search-input\"\n)\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['text']\n})\n\n</script>\n\n<style lang=\"scss\" scoped>\n.search {\n  color: white;\n  padding: 1px 8px;\n  border: 1px solid white;\n  border-radius: 10px;\n  font-size: 16px;\n  font-family: serif;\n  width: 100%;\n  box-sizing: border-box;\n  background: transparent;\n}\n</style>\n","export function debounce(delay: number, cb: () => void) {\n  return {\n    timeout: null as null | number,\n    cancel() {\n      if (this.timeout) {\n        window.clearTimeout(this.timeout)\n        this.timeout = null\n      }\n    },\n    call() {\n      this.timeout = window.setTimeout(() => {\n        cb()\n      }, delay)\n    }\n  }\n}\n","<template lang=\"pug\">\nBlock.block(\n  :class=\"{ hasSubitems: subitems }\"\n  data-testid=\"context-menu-item\"\n)\n  .content(\n    @click.stop=\"$emit('select', $event); $emit('hide')\"\n    @wheel.stop=\"\"\n    @pointerover=\"hide.cancel(); visibleSubitems = true\"\n    @pointerleave=\"hide.call()\"\n    @pointerdown.stop=\"\"\n  )\n    slot\n    .subitems(v-if=\"subitems && visibleSubitems\")\n      Item(\n        v-for=\"item of subitems\"\n        :key=\"item.key\"\n        @select=\"item.handler($event)\"\n        :delay=\"delay\"\n        @hide=\"$emit('hide')\"\n        :subitems=\"item.subitems\"\n      ) {{ item.label }}\n</template>\n\n<script>\nimport Block from './Block.vue'\nimport { debounce } from '../utils/debounce'\n\nexport default {\n  name: 'Item',\n  props: ['subitems', 'delay'],\n  data() {\n    return {\n      visibleSubitems: false,\n      hide: debounce(this.delay, this.hideSubitems)\n    }\n  },\n  methods: {\n    hideSubitems() {\n      this.visibleSubitems = false\n    }\n  },\n  components: {\n    Block\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../context-vars\";\n\n.block {\n  padding: 0;\n}\n\n.content {\n  padding: 4px;\n}\n\n.hasSubitems {\n  &:after {\n    content: '►';\n    position: absolute;\n    opacity: 0.6;\n    right: 5px;\n    top: 5px;\n  }\n}\n\n.subitems {\n  position: absolute;\n  top: 0;\n  left: 100%;\n  width: $width;\n}\n</style>\n","<template lang=\"pug\">\n.menu(\n  @mouseover=\"hide.cancel()\"\n  @mouseleave=\"hide.call()\"\n  data-testid=\"context-menu\"\n  rete-context-menu\n)\n  Block(v-if=\"searchBar\")\n    Search(:text=\"filter\" @change=\"filter = $event\")\n  Item(\n    v-for=\"item of getItems()\"\n    :key=\"item.key\"\n    @select=\"item.handler($event)\"\n    :delay=\"delay\"\n    @hide=\"onHide()\"\n    :subitems=\"item.subitems\"\n  )\n    | {{ item.label }}\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport Block from './Block.vue'\nimport Search from './Search.vue'\nimport Item from './Item.vue'\nimport { debounce } from '../utils/debounce'\n\nexport default defineComponent({\n  props: ['items', 'delay', 'searchBar', 'onHide', 'seed'],\n  data() {\n    return {\n      filter: '',\n      hide: debounce(this.delay, this.onHide)\n    }\n  },\n  methods: {\n    getItems() {\n      const filterRegexp = new RegExp(this.filter, 'i')\n      const filteredList = this.items.filter(item => (\n        item.label.match(filterRegexp)\n      ))\n\n      return filteredList\n    }\n  },\n  unmounted() {\n    if (this.hide) this.hide.cancel()\n  },\n  components: {\n    Block,\n    Search,\n    Item\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../context-vars\";\n\n.menu {\n  padding: 10px;\n  width: $width;\n  margin-top: -20px;\n  margin-left: - math.div($width, 2);\n}\n</style>\n","import { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport Menu from './components/Menu.vue'\nimport { ContextMenuRender } from './types'\n\n/**\n * Preset for rendering context menu.\n */\nexport function setup<Schemes extends BaseSchemes, K extends ContextMenuRender>(props?: { delay?: number }): RenderPreset<Schemes, K> {\n  const delay = typeof props?.delay === 'undefined' ? 1000 : props.delay\n\n  return {\n    update(context) {\n      if (context.data.type === 'contextmenu') {\n        return {\n          items: context.data.items,\n          delay,\n          searchBar: context.data.searchBar,\n          onHide: context.data.onHide\n        }\n      }\n    },\n    render(context) {\n      if (context.data.type === 'contextmenu') {\n        return {\n          component: Menu,\n          props: {\n            items: context.data.items,\n            delay,\n            searchBar: context.data.searchBar,\n            onHide: context.data.onHide\n          }\n        }\n      }\n    }\n  }\n}\n","export function px(value: number) {\n  return `${value}px`\n}\n","<template lang=\"pug\">\n.mini-node(:style=\"styles\" data-testid=\"minimap-node\")\n</template>\n\n<script>\nimport { px } from './utils'\n\nexport default {\n  props: ['left', 'top', 'width', 'height'],\n  computed: {\n    styles() {\n      return {\n        left: px(this.left),\n        top: px(this.top),\n        width: px(this.width),\n        height: px(this.height)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.mini-node {\n  position: absolute;\n  background: rgba(110, 136, 255, 0.8);\n  border: 1px solid rgb(192 206 212 / 60%);\n}\n</style>\n","import { Position } from '../types'\n\ntype Translate = (dx: number, dy: number) => void\ntype StartEvent = { pageX: number, pageY: number }\n\nexport function useDrag(translate: Translate, getPointer: (e: StartEvent) => Position) {\n  return {\n    start(e: StartEvent) {\n      let previous = { ...getPointer(e) }\n\n      function move(moveEvent: MouseEvent) {\n        const current = { ...getPointer(moveEvent) }\n        const dx = current.x - previous.x\n        const dy = current.y - previous.y\n\n        previous = current\n\n        translate(dx, dy)\n      }\n      function up() {\n        window.removeEventListener('pointermove', move)\n        window.removeEventListener('pointerup', up)\n        window.removeEventListener('pointercancel', up)\n      }\n\n      window.addEventListener('pointermove', move)\n      window.addEventListener('pointerup', up)\n      window.addEventListener('pointercancel', up)\n    }\n  }\n}\n","<template lang=\"pug\">\n.mini-viewport(\n  @pointerdown.stop=\"drag.start($event)\"\n  :style=\"styles\"\n  data-testid=\"minimap-viewport\"\n)\n</template>\n\n<script>\nimport { px } from './utils'\nimport { useDrag } from '../../shared/drag'\n\nexport default {\n  props: ['left', 'top', 'width', 'height', 'containerWidth', 'translate'],\n  data() {\n    return {\n      drag: useDrag(this.onDrag, e => ({ x: e.pageX, y: e.pageY }))\n    }\n  },\n  methods: {\n    scale(v) {\n      return v * this.containerWidth\n    },\n    invert(v) {\n      return v / this.containerWidth\n    },\n    onDrag(dx, dy) {\n      this.translate(this.invert(-dx), this.invert(-dy))\n    }\n  },\n  computed: {\n    styles() {\n\n      return {\n        left: px(this.scale(this.left)),\n        top: px(this.scale(this.top)),\n        width: px(this.scale(this.width)),\n        height: px(this.scale(this.height))\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.mini-viewport {\n  position: absolute;\n  background: rgba(255, 251, 128, 0.32);\n  border: 1px solid #ffe52b;\n}\n</style>\n","<template lang=\"pug\">\n.minimap(\n  ref=\"container\"\n  :style=\"{ width: px(size * ratio), height: px(size) }\"\n  @pointerdown.stop.prevent=\"\"\n  @dblclick.stop.prevent=\"dblclick($event)\"\n  data-testid=\"minimap\"\n)\n  MiniNode(\n    v-for=\"(node, index) of nodes\"\n    :key=\"[index, node.left].join('_')\"\n    :left=\"scale(node.left)\"\n    :top=\"scale(node.top)\"\n    :width=\"scale(node.width)\"\n    :height=\"scale(node.height)\"\n  )\n  MiniViewport(\n    :left=\"viewport.left\"\n    :top=\"viewport.top\"\n    :width=\"viewport.width\"\n    :height=\"viewport.height\"\n    :containerWidth=\"$refs.container && $refs.container.clientWidth\"\n    :translate=\"translate\"\n  )\n</template>\n\n<script>\nimport MiniNode from './MiniNode.vue'\nimport MiniViewport from './MiniViewport.vue'\nimport { px } from './utils'\n\nexport default {\n  props: {\n    size: Number,\n    ratio: Number,\n    nodes: Array,\n    viewport: Object,\n    translate: Function,\n    point: Function,\n    seed: Number\n  },\n  methods: {\n    dblclick(e) {\n      if (!this.$refs.container) return\n      const box = this.$refs.container.getBoundingClientRect()\n      const x = (e.clientX - box.left) / (this.size * this.ratio)\n      const y = (e.clientY - box.top) / (this.size * this.ratio)\n\n      this.point(x, y)\n    },\n    px,\n    scale(value) {\n      if (!this.$refs.container) return 0\n\n      return value * this.$refs.container.clientWidth\n    }\n  },\n  components: {\n    MiniNode,\n    MiniViewport\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.minimap {\n  position: absolute;\n  right: 24px;\n  bottom: 24px;\n  background: rgba(229, 234, 239, 0.65);\n  padding: 20px;\n  overflow: hidden;\n  border: 1px solid #b1b7ff;\n  border-radius: 8px;\n  box-sizing: border-box;\n}\n</style>\n","import { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport Minimap from './Minimap.vue'\nimport { MinimapRender } from './types'\n\n/**\n * Preset for rendering minimap.\n */\nexport function setup<Schemes extends BaseSchemes, K extends MinimapRender>(props?: { size?: number }): RenderPreset<Schemes, K> {\n  return {\n    update(context) {\n      if (context.data.type === 'minimap') {\n        return {\n          nodes: context.data.nodes,\n          size: props?.size || 200,\n          ratio: context.data.ratio,\n          viewport: context.data.viewport,\n          translate: context.data.translate,\n          point: context.data.point\n        }\n      }\n    },\n    render(context) {\n      if (context.data.type === 'minimap') {\n        return {\n          component: Minimap,\n          props: {\n            nodes: context.data.nodes,\n            size: props?.size || 200,\n            ratio: context.data.ratio,\n            viewport: context.data.viewport,\n            translate: context.data.translate,\n            point: context.data.point\n          }\n        }\n      }\n    }\n  }\n}\n","<template lang=\"pug\">\n.pins\n  Pin(\n    v-for=\"pin of pins\"\n    :key=\"pin.id\"\n    :position=\"pin.position\"\n    :selected=\"pin.selected\"\n    :getPointer=\"getPointer\"\n    @menu=\"menu(pin.id)\"\n    @translate=\"translate(pin.id, $event.dx, $event.dy)\"\n    @down=\"down(pin.id)\"\n  )\n</template>\n\n<script>\nimport Pin from './Pin.vue'\n\nexport default {\n  props: ['pins', 'menu', 'translate', 'down', 'seed', 'getPointer'],\n  components: {\n    Pin\n  }\n}\n</script>\n","<template lang=\"pug\">\n.pin(\n  @pointerdown.stop.prevent=\"drag.start($event); $emit('down')\"\n  @contextmenu.stop.prevent=\"$emit('menu')\"\n  :class=\"{ selected }\"\n  :style=\"style\"\n  data-testid=\"pin\"\n)\n</template>\n\n<script>\nimport { useDrag } from '../../shared/drag'\nconst pinSize = 20\n\nexport default {\n  props: ['position', 'selected', 'getPointer'],\n  data() {\n    return {\n      drag: useDrag(this.onDrag, this.getPointer)\n    }\n  },\n  computed: {\n    style() {\n      const { x, y } = this.position\n\n      return {\n        position: 'absolute',\n        top: `${y - pinSize / 2}px`,\n        left: `${x - pinSize / 2}px`\n      }\n    }\n  },\n  methods: {\n    onDrag(dx, dy) {\n      this.$emit('translate', { dx, dy })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n$size: 20px;\n\n.pin {\n  width: $size;\n  height: $size;\n  box-sizing: border-box;\n  background: steelblue;\n  border: 2px solid white;\n  border-radius: $size;\n\n  &.selected {\n    background: #ffd92c;\n  }\n}\n</style>\n","import { BaseSchemes } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { RenderPreset } from '../types'\nimport Pins from './Pins.vue'\nimport { PinsRender } from './types'\n\ntype Props = {\n  translate?: (id: string, dx: number, dy: number) => void\n  contextMenu?: (id: string) => void\n  pointerdown?: (id: string) => void\n}\n\n/**\n * Preset for rendering pins.\n */\nexport function setup<Schemes extends BaseSchemes, K extends PinsRender>(props?: Props): RenderPreset<Schemes, K> {\n  const getProps = () => ({\n    menu: props?.contextMenu || (() => null),\n    translate: props?.translate || (() => null),\n    down: props?.pointerdown || (() => null)\n  })\n\n  return {\n    update(context) {\n      if (context.data.type === 'reroute-pins') {\n        return {\n          ...getProps(),\n          pins: context.data.data.pins\n        }\n      }\n    },\n    render(context, plugin) {\n      if (context.data.type === 'reroute-pins') {\n        const area = plugin.parentScope<BaseAreaPlugin<Schemes, PinsRender>>(BaseAreaPlugin)\n\n        return {\n          component: Pins,\n          props: {\n            ...getProps(),\n            getPointer: () => area.area.pointer,\n            pins: context.data.data.pins\n          }\n        }\n      }\n    }\n  }\n}\n","import { BaseSchemes, CanAssignSignal, Scope } from 'rete'\n\nimport { RenderPreset } from './presets/types'\nimport { getRenderer, Renderer } from './renderer'\nimport { Position, RenderSignal } from './types'\n\nexport * as Presets from './presets'\nexport type { ClassicScheme, VueArea2D } from './presets/classic/types'\nexport type { RenderPreset } from './presets/types'\nexport { default as Ref } from './Ref.vue'\n\n/**\n * Signals that can be emitted by the plugin\n * @priority 10\n */\nexport type Produces<Schemes extends BaseSchemes> =\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\n\ntype Requires<Schemes extends BaseSchemes> =\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\n  | { type: 'unmount', data: { element: HTMLElement } }\n\n/**\n * Vue plugin. Renders nodes, connections and other elements using React.\n * @priority 9\n * @emits connectionpath\n * @listens render\n * @listens unmount\n */\nexport class VuePlugin<Schemes extends BaseSchemes, T = Requires<Schemes>> extends Scope<Produces<Schemes>, [Requires<Schemes> | T]> {\n  renderer: Renderer<unknown>\n  presets: RenderPreset<Schemes, T>[] = []\n  owners = new WeakMap<HTMLElement, RenderPreset<Schemes, T>>()\n\n  constructor() {\n    super('vue-render')\n    this.renderer = getRenderer()\n\n    this.addPipe(context => {\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n      if (context.type === 'unmount') {\n        this.unmount(context.data.element)\n      } else if (context.type === 'render') {\n        if ('filled' in context.data && context.data.filled) {\n          return context\n        }\n        if (this.mount(context.data.element, context as T)) {\n          return {\n            ...context,\n            data: {\n              ...context.data,\n              filled: true\n            }\n          } as typeof context\n        }\n      }\n\n      return context\n    })\n  }\n\n  setParent(scope: Scope<Requires<Schemes> | T>): void {\n    super.setParent(scope)\n\n    this.presets.forEach(preset => {\n      if (preset.attach) preset.attach(this)\n    })\n  }\n\n  private unmount(element: HTMLElement) {\n    this.owners.delete(element)\n    this.renderer.unmount(element)\n  }\n\n  private mount(element: HTMLElement, context: T) {\n    const existing = this.renderer.get(element)\n    const parent = this.parentScope()\n\n    if (existing) {\n      this.presets.forEach(preset => {\n        if (this.owners.get(element) !== preset) return\n        const result = preset.update(context as Extract<T, { type: 'render' }>, this)\n\n        if (result) {\n          this.renderer.update(existing, result)\n        }\n      })\n      return true\n    }\n\n    for (const preset of this.presets) {\n      const result = preset.render(context as Extract<T, { type: 'render' }>, this)\n\n      if (!result) continue\n\n      this.renderer.mount(\n        element,\n        result.component,\n        result.props,\n        () => parent?.emit({ type: 'rendered', data: (context as Requires<Schemes>).data } as T)\n      )\n\n      this.owners.set(element, preset)\n      return true\n    }\n  }\n\n  /**\n   * Adds a preset to the plugin.\n   * @param preset Preset that can render nodes, connections and other elements.\n   */\n  public addPreset<K>(preset: RenderPreset<Schemes, CanAssignSignal<T, K> extends true ? K : 'Cannot apply preset. Provided signals are not compatible'>) {\n    const local = preset as RenderPreset<Schemes, T>\n\n    if (local.attach) local.attach(this)\n    this.presets.push(local)\n  }\n}\n"],"names":["getRenderer","instances","Map","get","element","mount","vueComponent","payload","onRendered","app","component","state","ref","markRaw","createApp","render","h","_objectSpread","value","seed","Math","random","mounted","updated","create","set","update","instance","unmount","defineComponent","props","data","observedStart","x","y","observedEnd","observedPath","onDestroy","computed","startPosition","this","start","endPosition","end","watch","fetchPath","methods","async","path","created","unwatch1","pos","unwatch2","destroyed","change","e","val","type","target","setValue","emit","$refs","beforeDestroy","beforeUnmount","sortByIndex","entries","sort","a","b","index","_sfc_main$a","nodeStyles","width","Number","isFinite","height","inputs","Object","controls","outputs","components","Ref","positionWatcher","socketPositionWatcher","getDOMSocketPosition","_ref","customize","node","connection","socket","control","attach","plugin","context","parent","parentScope","Error","bind","_context$data","_path","Node","Connection","source","sourceOutput","targetInput","ConnectionWrapper","listen","_regeneratorRuntime","mark","_callee","response","_response$data","points","curvature","wrap","_context","prev","next","sent","abrupt","length","isLoop","loopConnectionPath","classicConnectionPath","stop","_x","_x2","apply","arguments","Socket","ClassicPreset","InputControl","Control","debounce","delay","cb","timeout","cancel","window","clearTimeout","call","setTimeout","name","visibleSubitems","hide","hideSubitems","Block","filter","onHide","getItems","filterRegexp","RegExp","items","item","label","match","unmounted","Search","Item","searchBar","Menu","px","concat","styles","left","top","useDrag","translate","getPointer","previous","move","moveEvent","current","dx","dy","up","removeEventListener","addEventListener","drag","onDrag","pageX","pageY","scale","v","containerWidth","invert","size","ratio","nodes","Array","viewport","Function","point","dblclick","container","box","getBoundingClientRect","clientX","clientY","clientWidth","MiniNode","MiniViewport","Minimap","Pin","style","position","pinSize","$emit","getProps","menu","contextMenu","down","pointerdown","pins","area","BaseAreaPlugin","Pins","pointer","VuePlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","WeakMap","renderer","addPipe","_typeof","filled","key","scope","_this2","_get","_getPrototypeOf","prototype","presets","forEach","preset","owners","_this3","existing","result","_step","_iterator","_createForOfIteratorHelper","s","n","done","err","f","local","push","Scope"],"mappings":"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"}