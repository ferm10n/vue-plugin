{"version":3,"file":"rete-vue-plugin.min.js","sources":["../../src/renderer.ts","../../src/vuecompat/vue2.ts","../../src/presets/classic/components/Connection.vue","../../src/presets/classic/components/ConnectionWrapper.vue","../../src/presets/classic/components/Control.vue","../../src/Ref.vue","../../src/presets/classic/components/Node.vue","../../src/presets/classic/components/Socket.vue","../../src/presets/classic/index.ts","../../src/presets/context-menu/components/Search.vue","../../src/presets/context-menu/utils/debounce.ts","../../src/presets/context-menu/components/Item.vue","../../src/presets/context-menu/components/Menu.vue","../../src/presets/context-menu/index.ts","../../src/presets/minimap/utils.ts","../../src/presets/minimap/MiniNode.vue","../../src/shared/drag.ts","../../src/presets/minimap/MiniViewport.vue","../../src/presets/minimap/Minimap.vue","../../src/presets/minimap/index.ts","../../src/presets/reroute/Pin.vue","../../src/presets/reroute/Pins.vue","../../src/presets/reroute/index.ts","../../src/index.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport { create, destroy, update } from 'process.env.VUECOMPAT'\n\nexport type Renderer<I> = {\n  get(element: Element): I | undefined\n  mount<P>(element: Element, vueComponent: any, payload: P, onRendered: any): I\n  update<P>(app: I, payload: P): void\n  unmount(element: Element): void\n}\n\nexport function getRenderer<I>(): Renderer<I> {\n  const instances = new Map<Element, I>()\n\n  return {\n    get(element) {\n      return instances.get(element)\n    },\n    mount(element, vueComponent, payload, onRendered) {\n      const app = create(element, vueComponent, payload, onRendered)\n\n      instances.set(element, app)\n\n      return app\n    },\n    update(app, payload) {\n      update(app, payload)\n    },\n    unmount(element) {\n      const app = instances.get(element)\n\n      if (app) {\n        destroy(app)\n        instances.delete(element)\n      }\n    }\n  }\n}\n","import Vue from 'vue'\n\nexport function create(element: any, component: any, payload: any, onRendered: any) {\n  const app = new Vue({\n    props: ['payload'],\n    render(h) {\n      return h(component, { props: { ...this.payload, seed: Math.random() }, ref: 'child' })\n    },\n    mounted() {\n      onRendered()\n    },\n    updated() {\n      onRendered()\n    }\n  })\n\n  app.payload = payload\n\n  const container = document.createElement('div')\n\n  if (container) {\n    element.appendChild(container)\n  }\n\n  app.$mount(container || element)\n\n  return app\n}\n\nexport function update(app: any, payload: any) {\n  app.payload = { ...app.payload, ...payload }\n\n  app.$refs.child.$forceUpdate()\n}\n\nexport function destroy(app: any) {\n  app.$destroy()\n  app.$el.remove()\n}\n","<template lang=\"pug\">\nsvg(data-testid=\"connection\")\n  path(:d=\"path\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data', 'start', 'end', 'path']\n})\n</script>\n\n<style lang=\"scss\" scoped>\n/*! https://github.com/retejs/connection-plugin/commit/206ca0fd7fb82801ac45a0f7180ae05dff9ed901 */\nsvg {\n  overflow: visible !important;\n  position: absolute;\n  pointer-events: none;\n  width: 9999px;\n  height: 9999px;\n  path {\n    fill: none;\n    stroke-width: 5px;\n    stroke: steelblue;\n    pointer-events: auto;\n  }\n}\n</style>\n","<template lang=\"pug\">\ncomponent(:is=\"component\" :data=\"data\" :start=\"startPosition\" :end=\"endPosition\", :path=\"observedPath\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n  props: ['component', 'data', 'start', 'end', 'path'],\n  data() {\n    return {\n      observedStart: { x: 0, y: 0 },\n      observedEnd: { x: 0, y: 0 },\n      observedPath: '',\n      onDestroy: null\n    }\n  },\n  computed: {\n    startPosition() {\n      if (this.start && 'x' in this.start) return this.start\n      return this.observedStart\n    },\n    endPosition() {\n      if (this.end && 'x' in this.end) return this.end\n      return this.observedEnd\n    }\n  },\n  watch: {\n    startPosition() { this.fetchPath() },\n    endPosition() { this.fetchPath() }\n  },\n  methods: {\n    async fetchPath() {\n      if (this.startPosition && this.endPosition) {\n        this.observedPath = await this.path(this.startPosition, this.endPosition)\n      }\n    }\n  },\n  created() {\n    const unwatch1 = typeof this.start === 'function' && this.start(pos => {\n      this.observedStart = pos\n    })\n    const unwatch2 = typeof this.end === 'function' && this.end(pos => {\n      this.observedEnd = pos\n    })\n\n    this.onDestroy = () => {\n      unwatch1 && unwatch1()\n      unwatch2 && unwatch2()\n    }\n  },\n  destroyed() {\n    if (this.onDestroy) this.onDestroy()\n  }\n})\n</script>\n","<template lang=\"pug\">\ninput(\n  :type=\"data.type\"\n  :value=\"data.value\"\n  :readonly=\"data.readonly\"\n  @input=\"change\"\n  @pointerdown.stop=\"\"\n)\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data'],\n  methods: {\n    change(e) {\n      const val = this.data.type === 'number'\n        ? +e.target.value\n        : e.target.value\n\n      this.data.setValue(val)\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\ninput {\n  width: 100%;\n  border-radius: 30px;\n  background-color: white;\n  padding: 2px 6px;\n  border: 1px solid #999;\n  font-size: 110%;\n  box-sizing: border-box;\n}\n</style>\n","<template lang=\"pug\">\ndiv(v-bind=\"$props\" ref=\"element\")\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['data', 'emit'],\n  mounted() {\n    this.emit({ type: 'render', data: { ...this.data, element: this.$refs.element } })\n  },\n  beforeDestroy() {\n    this.emit({ type: 'unmount', data: { element: this.$refs.element } })\n  },\n  beforeUnmount() {\n    this.emit({ type: 'unmount', data: { element: this.$refs.element } })\n  }\n})\n</script>\n","<template lang=\"pug\">\n.node(:class=\"{ selected: data.selected }\" :style=\"nodeStyles()\" data-testid=\"node\")\n  .title(data-testid=\"title\") {{data.label}}\n\n  // Outputs\n  .output(v-for='[key, output] in outputs()' :key=\"'output' + key + seed\" :data-testid=\"'output-'+key\")\n    .output-title(data-testid=\"output-title\") {{output.label}}\n    Ref.output-socket(\n      :data=\"{ type: 'socket', side: 'output', key: key, nodeId: data.id, payload: output.socket }\"\n      :emit=\"emit\"\n      data-testid=\"output-socket\")\n\n  // Controls\n  Ref.control(\n    v-for='[key, control] in controls()',\n    :key=\"'control' + key + seed\",\n    :data-testid=\"'control-'+key\"\n    :emit=\"emit\"\n    :data=\"{ type: 'control', payload: control }\"\n  )\n\n  // Inputs\n  .input(v-for='[key, input] in inputs()' :key=\"'input' + key + seed\" :data-testid=\"'input-'+key\")\n    Ref.input-socket(\n      :data=\"{ type: 'socket', side: 'input', key: key, nodeId: data.id, payload: input.socket }\"\n      :emit=\"emit\"\n      data-testid=\"input-socket\"\n    )\n    .input-title(v-show='!input.control || !input.showControl' data-testid=\"input-title\") {{input.label}}\n    Ref.input-control(\n      v-show='input.control && input.showControl'\n      :emit=\"emit\"\n      :data=\"{ type: 'control', payload: input.control }\"\n      data-testid=\"input-control\"\n    )\n</template>\n\n\n<script lang=\"js\">\nimport { defineComponent } from 'vue'\nimport Ref from '../../../Ref.vue'\n\nfunction sortByIndex(entries) {\n  entries.sort((a, b) => {\n    const ai = a[1] && a[1].index || 0\n    const bi = b[1] && b[1].index || 0\n\n    return ai - bi\n  })\n  return entries\n}\n\nexport default defineComponent({\n  props: ['data', 'emit', 'seed'],\n  methods: {\n    nodeStyles() {\n      return {\n        width: Number.isFinite(this.data.width) ? `${this.data.width}px` : '',\n        height: Number.isFinite(this.data.height) ? `${this.data.height}px` : ''\n      }\n    },\n    inputs() {\n      return sortByIndex(Object.entries(this.data.inputs))\n    },\n    controls() {\n      return sortByIndex(Object.entries(this.data.controls))\n    },\n    outputs() {\n      return sortByIndex(Object.entries(this.data.outputs))\n    }\n  },\n  components: {\n    Ref\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\n.node {\n  background: $node-color;\n  border: 2px solid #4e58bf;\n  border-radius: 10px;\n  cursor: pointer;\n  box-sizing: border-box;\n  width: $node-width;\n  height: auto;\n  padding-bottom: 6px;\n  position: relative;\n  user-select: none;\n  line-height: initial;\n  font-family: Arial;\n\n  &:hover {\n    background: lighten($node-color, 4%);\n  }\n\n  &.selected {\n    background: $node-color-selected;\n    border-color: #e3c000;\n  }\n\n  .title {\n    color: white;\n    font-family: sans-serif;\n    font-size: 18px;\n    padding: 8px;\n  }\n\n  .output {\n    text-align: right;\n  }\n\n  .input {\n    text-align: left;\n  }\n\n  .output-socket {\n    text-align: right;\n    margin-right: -(math.div($socket-size, 2) + $socket-margin);\n    display: inline-block;\n  }\n\n  .input-socket {\n    text-align: left;\n    margin-left: -(math.div($socket-size, 2) + $socket-margin);\n    display: inline-block;\n  }\n\n  .input-title,\n  .output-title {\n    vertical-align: middle;\n    color: white;\n    display: inline-block;\n    font-family: sans-serif;\n    font-size: 14px;\n    margin: $socket-margin;\n    line-height: $socket-size;\n  }\n\n  .input-control {\n    z-index: 1;\n    width: calc(100% - #{$socket-size + 2*$socket-margin});\n    vertical-align: middle;\n    display: inline-block;\n  }\n\n  .control {\n    padding: $socket-margin math.div($socket-size, 2) + $socket-margin;\n  }\n}\n</style>\n","<template lang=\"pug\">\n.socket(\n  :title=\"data.name\"\n)\n</template>\n\n<script>\nexport default {\n  props: ['data']\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../vars\";\n\n.socket {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid white;\n  border-radius: math.div($socket-size, 2);\n  width: $socket-size;\n  height: $socket-size;\n  margin: $socket-margin;\n  vertical-align: middle;\n  background: $socket-color;\n  z-index: 2;\n  box-sizing: border-box;\n  &:hover {\n    border-width: 4px;\n  }\n  &.multiple {\n    border-color: yellow;\n  }\n  &.output {\n    margin-right: - math.div($socket-size, 2);\n  }\n  &.input {\n    margin-left: - math.div($socket-size, 2);\n  }\n}\n</style>\n","import { ClassicPreset, Scope } from 'rete'\nimport { classicConnectionPath, getDOMSocketPosition, loopConnectionPath, SocketPositionWatcher } from 'rete-render-utils'\nimport Vue, { DefineComponent, VueConstructor } from 'vue'\n\nimport { Position } from '../../types'\nimport { RenderPreset } from '../types'\nimport Connection from './components/Connection.vue'\nimport ConnectionWrapper from './components/ConnectionWrapper.vue'\nimport Control from './components/Control.vue'\nimport Node from './components/Node.vue'\nimport Socket from './components/Socket.vue'\nimport { ClassicScheme, ExtractPayload, VueArea2D } from './types'\n\nexport { default as Connection } from './components/Connection.vue'\nexport { default as Control } from './components/Control.vue'\nexport { default as Node } from './components/Node.vue'\nexport { default as Socket } from './components/Socket.vue'\n\ntype Component<Props extends Record<string, any>> =\n  | VueConstructor<Vue<Record<string, any>, Props>>\n  | DefineComponent<Props, any, any, any, any, any, any, any, any, any, any>\n\ntype CustomizationProps<Schemes extends ClassicScheme> = {\n  node?: (data: ExtractPayload<Schemes, 'node'>) => Component<any> | null\n  connection?: (data: ExtractPayload<Schemes, 'connection'>) => Component<any> | null\n  socket?: (data: ExtractPayload<Schemes, 'socket'>) => Component<any> | null\n  control?: (data: ExtractPayload<Schemes, 'control'>) => Component<any> | null\n}\ntype ClassicProps<Schemes extends ClassicScheme, K> = {\n  socketPositionWatcher?: SocketPositionWatcher<Scope<never, [K]>>,\n  customize?: CustomizationProps<Schemes>\n}\n\n/**\n * Classic preset for rendering nodes, connections, controls and sockets.\n */\nexport function setup<Schemes extends ClassicScheme, K extends VueArea2D<Schemes>>(\n  props?: ClassicProps<Schemes, K>\n): RenderPreset<Schemes, K> {\n  const positionWatcher = typeof props?.socketPositionWatcher === 'undefined'\n    ? getDOMSocketPosition<Schemes, K>()\n    : props?.socketPositionWatcher\n  const { node, connection, socket, control } = props?.customize || {}\n\n  return {\n    attach(plugin) {\n      positionWatcher.attach(plugin as unknown as Scope<never, [K]>)\n    },\n    update(context, plugin) {\n      const { payload } = context.data\n      const parent = plugin.parentScope()\n\n      if (!parent) throw new Error('parent')\n      const emit = parent.emit.bind(parent)\n\n      if (context.data.type === 'node') {\n        return { data: payload, emit }\n      } else if (context.data.type === 'connection') {\n        const { start, end } = context.data\n\n        return {\n          data: payload,\n          ...(start ? { start } : {}),\n          ...(end ? { end } : {})\n        }\n      }\n      return { data: payload }\n    },\n    // eslint-disable-next-line max-statements, complexity\n    render(context, plugin) {\n      const parent = plugin.parentScope()\n      const emit = parent.emit.bind(parent)\n\n      if (context.data.type === 'node') {\n        const component = node ? node(context.data) : Node\n\n        return component && {\n          component, props: {\n            data: context.data.payload,\n            emit\n          }\n        }\n      } else if (context.data.type === 'connection') {\n        const component = connection ? connection(context.data) : Connection\n        const { payload } = context.data\n        const { source, target, sourceOutput, targetInput } = payload\n\n        return component && {\n          component: ConnectionWrapper, props: {\n            data: context.data.payload,\n            component,\n            start: context.data.start || ((change: any) => positionWatcher.listen(source, 'output', sourceOutput, change)),\n            end: context.data.end || ((change: any) => positionWatcher.listen(target, 'input', targetInput, change)),\n            path: async (start: Position, end: Position) => {\n              const response = await plugin.emit({ type: 'connectionpath', data: { payload, points: [start, end] } })\n\n              if (!response) return ''\n\n              const { path, points } = response.data\n              const curvature = 0.3\n\n              if (!path && points.length !== 2) throw new Error('cannot render connection with a custom number of points')\n              if (!path) return payload.isLoop\n                ? loopConnectionPath(points as [Position, Position], curvature, 120)\n                : classicConnectionPath(points as [Position, Position], curvature)\n\n              return path\n            }\n          }\n        }\n      } else if (context.data.type === 'socket') {\n        const { payload } = context.data\n        const component = socket ? socket(context.data) : Socket\n\n        return {\n          component, props: {\n            data: payload\n          }\n        }\n      } else if (context.data.type === 'control') {\n        const { payload } = context.data\n\n        if (control) {\n          const component = control(context.data)\n\n          return component && {\n            component, props: {\n              data: payload\n            }\n          }\n        }\n\n        return context.data.payload instanceof ClassicPreset.InputControl\n          ? {\n            component: Control, props: {\n              data: payload\n            }\n          }\n          : null\n      }\n    }\n  }\n}\n","<template lang=\"pug\">\n//- v-model cannot be used here due to compatibility with Vue 2 and 3\ninput.search(\n  :value=\"text\"\n  @input=\"$emit('change', $event.target.value)\"\n  data-testid=\"context-menu-search-input\"\n)\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  props: ['text']\n})\n\n</script>\n\n<style lang=\"scss\" scoped>\n.search {\n  color: white;\n  padding: 1px 8px;\n  border: 1px solid white;\n  border-radius: 10px;\n  font-size: 16px;\n  font-family: serif;\n  width: 100%;\n  box-sizing: border-box;\n  background: transparent;\n}\n</style>\n","export function debounce(delay: number, cb: () => void) {\n  return {\n    timeout: null as null | number,\n    cancel() {\n      if (this.timeout) {\n        window.clearTimeout(this.timeout)\n        this.timeout = null\n      }\n    },\n    call() {\n      this.timeout = window.setTimeout(() => {\n        cb()\n      }, delay)\n    }\n  }\n}\n","<template lang=\"pug\">\nBlock.block(\n  :class=\"{ hasSubitems: subitems }\"\n  data-testid=\"context-menu-item\"\n)\n  .content(\n    @click.stop=\"$emit('select', $event); $emit('hide')\"\n    @wheel.stop=\"\"\n    @pointerover=\"hide.cancel(); visibleSubitems = true\"\n    @pointerleave=\"hide.call()\"\n    @pointerdown.stop=\"\"\n  )\n    slot\n    .subitems(v-if=\"subitems && visibleSubitems\")\n      Item(\n        v-for=\"item of subitems\"\n        :key=\"item.key\"\n        @select=\"item.handler($event)\"\n        :delay=\"delay\"\n        @hide=\"$emit('hide')\"\n        :subitems=\"item.subitems\"\n      ) {{ item.label }}\n</template>\n\n<script>\nimport Block from './Block.vue'\nimport { debounce } from '../utils/debounce'\n\nexport default {\n  name: 'Item',\n  props: ['subitems', 'delay'],\n  data() {\n    return {\n      visibleSubitems: false,\n      hide: debounce(this.delay, this.hideSubitems)\n    }\n  },\n  methods: {\n    hideSubitems() {\n      this.visibleSubitems = false\n    }\n  },\n  components: {\n    Block\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../context-vars\";\n\n.block {\n  padding: 0;\n}\n\n.content {\n  padding: 4px;\n}\n\n.hasSubitems {\n  &:after {\n    content: '►';\n    position: absolute;\n    opacity: 0.6;\n    right: 5px;\n    top: 5px;\n  }\n}\n\n.subitems {\n  position: absolute;\n  top: 0;\n  left: 100%;\n  width: $width;\n}\n</style>\n","<template lang=\"pug\">\n.menu(\n  @mouseover=\"hide.cancel()\"\n  @mouseleave=\"hide.call()\"\n  data-testid=\"context-menu\"\n  rete-context-menu\n)\n  Block(v-if=\"searchBar\")\n    Search(:text=\"filter\" @change=\"filter = $event\")\n  Item(\n    v-for=\"item of getItems()\"\n    :key=\"item.key\"\n    @select=\"item.handler($event)\"\n    :delay=\"delay\"\n    @hide=\"onHide()\"\n    :subitems=\"item.subitems\"\n  )\n    | {{ item.label }}\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport Block from './Block.vue'\nimport Search from './Search.vue'\nimport Item from './Item.vue'\nimport { debounce } from '../utils/debounce'\n\nexport default defineComponent({\n  props: ['items', 'delay', 'searchBar', 'onHide', 'seed'],\n  data() {\n    return {\n      filter: '',\n      hide: debounce(this.delay, this.onHide)\n    }\n  },\n  methods: {\n    getItems() {\n      const filterRegexp = new RegExp(this.filter, 'i')\n      const filteredList = this.items.filter(item => (\n        item.label.match(filterRegexp)\n      ))\n\n      return filteredList\n    }\n  },\n  unmounted() {\n    if (this.hide) this.hide.cancel()\n  },\n  components: {\n    Block,\n    Search,\n    Item\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n@import \"../context-vars\";\n\n.menu {\n  padding: 10px;\n  width: $width;\n  margin-top: -20px;\n  margin-left: - math.div($width, 2);\n}\n</style>\n","import { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport Menu from './components/Menu.vue'\nimport { ContextMenuRender } from './types'\n\n/**\n * Preset for rendering context menu.\n */\nexport function setup<Schemes extends BaseSchemes, K extends ContextMenuRender>(props?: { delay?: number }): RenderPreset<Schemes, K> {\n  const delay = typeof props?.delay === 'undefined' ? 1000 : props.delay\n\n  return {\n    update(context) {\n      if (context.data.type === 'contextmenu') {\n        return {\n          items: context.data.items,\n          delay,\n          searchBar: context.data.searchBar,\n          onHide: context.data.onHide\n        }\n      }\n    },\n    render(context) {\n      if (context.data.type === 'contextmenu') {\n        return {\n          component: Menu,\n          props: {\n            items: context.data.items,\n            delay,\n            searchBar: context.data.searchBar,\n            onHide: context.data.onHide\n          }\n        }\n      }\n    }\n  }\n}\n","export function px(value: number) {\n  return `${value}px`\n}\n","<template lang=\"pug\">\n.mini-node(:style=\"styles\" data-testid=\"minimap-node\")\n</template>\n\n<script>\nimport { px } from './utils'\n\nexport default {\n  props: ['left', 'top', 'width', 'height'],\n  computed: {\n    styles() {\n      return {\n        left: px(this.left),\n        top: px(this.top),\n        width: px(this.width),\n        height: px(this.height)\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.mini-node {\n  position: absolute;\n  background: rgba(110, 136, 255, 0.8);\n  border: 1px solid rgb(192 206 212 / 60%);\n}\n</style>\n","import { Position } from '../types'\n\ntype Translate = (dx: number, dy: number) => void\ntype StartEvent = { pageX: number, pageY: number }\n\nexport function useDrag(translate: Translate, getPointer: (e: StartEvent) => Position) {\n  return {\n    start(e: StartEvent) {\n      let previous = { ...getPointer(e) }\n\n      function move(moveEvent: MouseEvent) {\n        const current = { ...getPointer(moveEvent) }\n        const dx = current.x - previous.x\n        const dy = current.y - previous.y\n\n        previous = current\n\n        translate(dx, dy)\n      }\n      function up() {\n        window.removeEventListener('pointermove', move)\n        window.removeEventListener('pointerup', up)\n        window.removeEventListener('pointercancel', up)\n      }\n\n      window.addEventListener('pointermove', move)\n      window.addEventListener('pointerup', up)\n      window.addEventListener('pointercancel', up)\n    }\n  }\n}\n","<template lang=\"pug\">\n.mini-viewport(\n  @pointerdown.stop=\"drag.start($event)\"\n  :style=\"styles\"\n  data-testid=\"minimap-viewport\"\n)\n</template>\n\n<script>\nimport { px } from './utils'\nimport { useDrag } from '../../shared/drag'\n\nexport default {\n  props: ['left', 'top', 'width', 'height', 'containerWidth', 'translate'],\n  data() {\n    return {\n      drag: useDrag(this.onDrag, e => ({ x: e.pageX, y: e.pageY }))\n    }\n  },\n  methods: {\n    scale(v) {\n      return v * this.containerWidth\n    },\n    invert(v) {\n      return v / this.containerWidth\n    },\n    onDrag(dx, dy) {\n      this.translate(this.invert(-dx), this.invert(-dy))\n    }\n  },\n  computed: {\n    styles() {\n\n      return {\n        left: px(this.scale(this.left)),\n        top: px(this.scale(this.top)),\n        width: px(this.scale(this.width)),\n        height: px(this.scale(this.height))\n      }\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.mini-viewport {\n  position: absolute;\n  background: rgba(255, 251, 128, 0.32);\n  border: 1px solid #ffe52b;\n}\n</style>\n","<template lang=\"pug\">\n.minimap(\n  ref=\"container\"\n  :style=\"{ width: px(size * ratio), height: px(size) }\"\n  @pointerdown.stop.prevent=\"\"\n  @dblclick.stop.prevent=\"dblclick($event)\"\n  data-testid=\"minimap\"\n)\n  MiniNode(\n    v-for=\"(node, index) of nodes\"\n    :key=\"[index, node.left].join('_')\"\n    :left=\"scale(node.left)\"\n    :top=\"scale(node.top)\"\n    :width=\"scale(node.width)\"\n    :height=\"scale(node.height)\"\n  )\n  MiniViewport(\n    :left=\"viewport.left\"\n    :top=\"viewport.top\"\n    :width=\"viewport.width\"\n    :height=\"viewport.height\"\n    :containerWidth=\"$refs.container && $refs.container.clientWidth\"\n    :translate=\"translate\"\n  )\n</template>\n\n<script>\nimport MiniNode from './MiniNode.vue'\nimport MiniViewport from './MiniViewport.vue'\nimport { px } from './utils'\n\nexport default {\n  props: {\n    size: Number,\n    ratio: Number,\n    nodes: Array,\n    viewport: Object,\n    translate: Function,\n    point: Function,\n    seed: Number\n  },\n  methods: {\n    dblclick(e) {\n      if (!this.$refs.container) return\n      const box = this.$refs.container.getBoundingClientRect()\n      const x = (e.clientX - box.left) / (this.size * this.ratio)\n      const y = (e.clientY - box.top) / (this.size * this.ratio)\n\n      this.point(x, y)\n    },\n    px,\n    scale(value) {\n      if (!this.$refs.container) return 0\n\n      return value * this.$refs.container.clientWidth\n    }\n  },\n  components: {\n    MiniNode,\n    MiniViewport\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.minimap {\n  position: absolute;\n  right: 24px;\n  bottom: 24px;\n  background: rgba(229, 234, 239, 0.65);\n  padding: 20px;\n  overflow: hidden;\n  border: 1px solid #b1b7ff;\n  border-radius: 8px;\n  box-sizing: border-box;\n}\n</style>\n","import { BaseSchemes } from 'rete'\n\nimport { RenderPreset } from '../types'\nimport Minimap from './Minimap.vue'\nimport { MinimapRender } from './types'\n\n/**\n * Preset for rendering minimap.\n */\nexport function setup<Schemes extends BaseSchemes, K extends MinimapRender>(props?: { size?: number }): RenderPreset<Schemes, K> {\n  return {\n    update(context) {\n      if (context.data.type === 'minimap') {\n        return {\n          nodes: context.data.nodes,\n          size: props?.size || 200,\n          ratio: context.data.ratio,\n          viewport: context.data.viewport,\n          translate: context.data.translate,\n          point: context.data.point\n        }\n      }\n    },\n    render(context) {\n      if (context.data.type === 'minimap') {\n        return {\n          component: Minimap,\n          props: {\n            nodes: context.data.nodes,\n            size: props?.size || 200,\n            ratio: context.data.ratio,\n            viewport: context.data.viewport,\n            translate: context.data.translate,\n            point: context.data.point\n          }\n        }\n      }\n    }\n  }\n}\n","<template lang=\"pug\">\n.pin(\n  @pointerdown.stop.prevent=\"drag.start($event); $emit('down')\"\n  @contextmenu.stop.prevent=\"$emit('menu')\"\n  :class=\"{ selected }\"\n  :style=\"style\"\n  data-testid=\"pin\"\n)\n</template>\n\n<script>\nimport { useDrag } from '../../shared/drag'\nconst pinSize = 20\n\nexport default {\n  props: ['position', 'selected', 'getPointer'],\n  data() {\n    return {\n      drag: useDrag(this.onDrag, this.getPointer)\n    }\n  },\n  computed: {\n    style() {\n      const { x, y } = this.position\n\n      return {\n        position: 'absolute',\n        top: `${y - pinSize / 2}px`,\n        left: `${x - pinSize / 2}px`\n      }\n    }\n  },\n  methods: {\n    onDrag(dx, dy) {\n      this.$emit('translate', { dx, dy })\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n$size: 20px;\n\n.pin {\n  width: $size;\n  height: $size;\n  box-sizing: border-box;\n  background: steelblue;\n  border: 2px solid white;\n  border-radius: $size;\n\n  &.selected {\n    background: #ffd92c;\n  }\n}\n</style>\n","<template lang=\"pug\">\n.pins\n  Pin(\n    v-for=\"pin of pins\"\n    :key=\"pin.id\"\n    :position=\"pin.position\"\n    :selected=\"pin.selected\"\n    :getPointer=\"getPointer\"\n    @menu=\"menu(pin.id)\"\n    @translate=\"translate(pin.id, $event.dx, $event.dy)\"\n    @down=\"down(pin.id)\"\n  )\n</template>\n\n<script>\nimport Pin from './Pin.vue'\n\nexport default {\n  props: ['pins', 'menu', 'translate', 'down', 'seed', 'getPointer'],\n  components: {\n    Pin\n  }\n}\n</script>\n","import { BaseSchemes } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { RenderPreset } from '../types'\nimport Pins from './Pins.vue'\nimport { PinsRender } from './types'\n\ntype Props = {\n  translate?: (id: string, dx: number, dy: number) => void\n  contextMenu?: (id: string) => void\n  pointerdown?: (id: string) => void\n}\n\n/**\n * Preset for rendering pins.\n */\nexport function setup<Schemes extends BaseSchemes, K extends PinsRender>(props?: Props): RenderPreset<Schemes, K> {\n  const getProps = () => ({\n    menu: props?.contextMenu || (() => null),\n    translate: props?.translate || (() => null),\n    down: props?.pointerdown || (() => null)\n  })\n\n  return {\n    update(context) {\n      if (context.data.type === 'reroute-pins') {\n        return {\n          ...getProps(),\n          pins: context.data.data.pins\n        }\n      }\n    },\n    render(context, plugin) {\n      if (context.data.type === 'reroute-pins') {\n        const area = plugin.parentScope<BaseAreaPlugin<Schemes, PinsRender>>(BaseAreaPlugin)\n\n        return {\n          component: Pins,\n          props: {\n            ...getProps(),\n            getPointer: () => area.area.pointer,\n            pins: context.data.data.pins\n          }\n        }\n      }\n    }\n  }\n}\n","import { BaseSchemes, CanAssignSignal, Scope } from 'rete'\n\nimport { RenderPreset } from './presets/types'\nimport { getRenderer, Renderer } from './renderer'\nimport { Position, RenderSignal } from './types'\n\nexport * as Presets from './presets'\nexport type { ClassicScheme, VueArea2D } from './presets/classic/types'\nexport type { RenderPreset } from './presets/types'\nexport { default as Ref } from './Ref.vue'\n\n/**\n * Signals that can be emitted by the plugin\n * @priority 10\n */\nexport type Produces<Schemes extends BaseSchemes> =\n  | { type: 'connectionpath', data: { payload: Schemes['Connection'], path?: string, points: Position[] } }\n\ntype Requires<Schemes extends BaseSchemes> =\n  | RenderSignal<'node', { payload: Schemes['Node'] }>\n  | RenderSignal<'connection', { payload: Schemes['Connection'], start?: Position, end?: Position }>\n  | { type: 'unmount', data: { element: HTMLElement } }\n\n/**\n * Vue plugin. Renders nodes, connections and other elements using React.\n * @priority 9\n * @emits connectionpath\n * @listens render\n * @listens unmount\n */\nexport class VuePlugin<Schemes extends BaseSchemes, T = Requires<Schemes>> extends Scope<Produces<Schemes>, [Requires<Schemes> | T]> {\n  renderer: Renderer<unknown>\n  presets: RenderPreset<Schemes, T>[] = []\n  owners = new WeakMap<HTMLElement, RenderPreset<Schemes, T>>()\n\n  constructor() {\n    super('vue-render')\n    this.renderer = getRenderer()\n\n    this.addPipe(context => {\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n      if (context.type === 'unmount') {\n        this.unmount(context.data.element)\n      } else if (context.type === 'render') {\n        if ('filled' in context.data && context.data.filled) {\n          return context\n        }\n        if (this.mount(context.data.element, context as T)) {\n          return {\n            ...context,\n            data: {\n              ...context.data,\n              filled: true\n            }\n          } as typeof context\n        }\n      }\n\n      return context\n    })\n  }\n\n  setParent(scope: Scope<Requires<Schemes> | T>): void {\n    super.setParent(scope)\n\n    this.presets.forEach(preset => {\n      if (preset.attach) preset.attach(this)\n    })\n  }\n\n  private unmount(element: HTMLElement) {\n    this.owners.delete(element)\n    this.renderer.unmount(element)\n  }\n\n  private mount(element: HTMLElement, context: T) {\n    const existing = this.renderer.get(element)\n    const parent = this.parentScope()\n\n    if (existing) {\n      this.presets.forEach(preset => {\n        if (this.owners.get(element) !== preset) return\n        const result = preset.update(context as Extract<T, { type: 'render' }>, this)\n\n        if (result) {\n          this.renderer.update(existing, result)\n        }\n      })\n      return true\n    }\n\n    for (const preset of this.presets) {\n      const result = preset.render(context as Extract<T, { type: 'render' }>, this)\n\n      if (!result) continue\n\n      this.renderer.mount(\n        element,\n        result.component,\n        result.props,\n        () => parent?.emit({ type: 'rendered', data: (context as Requires<Schemes>).data } as T)\n      )\n\n      this.owners.set(element, preset)\n      return true\n    }\n  }\n\n  /**\n   * Adds a preset to the plugin.\n   * @param preset Preset that can render nodes, connections and other elements.\n   */\n  public addPreset<K>(preset: RenderPreset<Schemes, CanAssignSignal<T, K> extends true ? K : 'Cannot apply preset. Provided signals are not compatible'>) {\n    const local = preset as RenderPreset<Schemes, T>\n\n    if (local.attach) local.attach(this)\n    this.presets.push(local)\n  }\n}\n"],"names":["getRenderer","instances","Map","get","element","mount","vueComponent","payload","onRendered","app","component","Vue","props","render","h","_objectSpread","this","seed","Math","random","ref","mounted","updated","container","document","createElement","appendChild","$mount","create","set","update","$refs","child","$forceUpdate","unmount","$destroy","$el","remove","destroy","defineComponent","data","observedStart","x","y","observedEnd","observedPath","onDestroy","computed","startPosition","start","endPosition","end","watch","fetchPath","methods","async","path","created","unwatch1","pos","unwatch2","destroyed","change","e","val","type","target","value","setValue","emit","beforeDestroy","beforeUnmount","sortByIndex","entries","sort","a","b","index","_sfc_main$a","nodeStyles","width","Number","isFinite","height","inputs","Object","controls","outputs","components","Ref","positionWatcher","socketPositionWatcher","getDOMSocketPosition","_ref","customize","node","connection","socket","control","attach","plugin","context","parent","parentScope","Error","bind","_context$data","_path","Node","Connection","source","sourceOutput","targetInput","ConnectionWrapper","listen","_regeneratorRuntime","mark","_callee","response","_response$data","points","curvature","wrap","_context","prev","next","sent","abrupt","length","isLoop","loopConnectionPath","classicConnectionPath","stop","_x","_x2","apply","arguments","Socket","ClassicPreset","InputControl","Control","debounce","delay","cb","timeout","cancel","window","clearTimeout","call","setTimeout","name","visibleSubitems","hide","hideSubitems","Block","filter","onHide","getItems","filterRegexp","RegExp","items","item","label","match","unmounted","Search","Item","searchBar","Menu","px","concat","styles","left","top","useDrag","translate","getPointer","previous","move","moveEvent","current","dx","dy","up","removeEventListener","addEventListener","drag","onDrag","pageX","pageY","scale","v","containerWidth","invert","size","ratio","nodes","Array","viewport","Function","point","dblclick","box","getBoundingClientRect","clientX","clientY","clientWidth","MiniNode","MiniViewport","Minimap","style","position","pinSize","$emit","Pin","getProps","menu","contextMenu","down","pointerdown","pins","area","BaseAreaPlugin","Pins","pointer","VuePlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","WeakMap","renderer","addPipe","_typeof","filled","key","scope","_this2","_get","_getPrototypeOf","prototype","presets","forEach","preset","owners","_this3","existing","result","_step","_iterator","_createForOfIteratorHelper","s","n","done","err","f","local","push","Scope"],"mappings":"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"}